name: 'GoReleaser Check'
description: 'Run GoReleaser check and build to validate configuration'
author: 'sivchari'

inputs:
  go-version-file:
    description: 'Path to go.mod file for Go version detection'
    required: false
    default: 'go.mod'
  working-directory:
    description: 'Working directory to run GoReleaser check in'
    required: false
    default: '.'
  goreleaser-version:
    description: 'Version of GoReleaser to use'
    required: false
    default: '~> v2'
  args:
    description: 'Additional arguments to pass to GoReleaser check'
    required: false
    default: ''
  snapshot-build:
    description: 'Run snapshot build after check'
    required: false
    default: 'true'

runs:
  using: 'composite'
  steps:
    - name: Set up Go
      uses: actions/setup-go@d35c59abb061a4a6fb18e82ac0862c26744d6ab5 # v5.5.0
      with:
        go-version-file: ${{ inputs.go-version-file }}
        cache: true
        cache-dependency-path: ${{ inputs.working-directory }}/go.sum

    - name: Run GoReleaser check
      uses: goreleaser/goreleaser-action@286f3b13b1b49da4ac219696163fb8c1c93e1200 # v6.0.0
      with:
        distribution: goreleaser
        version: ${{ inputs.goreleaser-version }}
        args: check ${{ inputs.args }}
        workdir: ${{ inputs.working-directory }}

    - name: Run GoReleaser snapshot build
      if: inputs.snapshot-build == 'true'
      uses: goreleaser/goreleaser-action@286f3b13b1b49da4ac219696163fb8c1c93e1200 # v6.0.0
      with:
        distribution: goreleaser
        version: ${{ inputs.goreleaser-version }}
        args: build --snapshot --clean
        workdir: ${{ inputs.working-directory }}

branding:
  icon: 'package'
  color: 'blue'